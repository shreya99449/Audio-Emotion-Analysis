{% extends 'layout.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">  <!-- Increased width to accommodate more content -->
        <div class="card bg-dark border-secondary shadow-lg">
            <div class="card-header p-4 bg-gradient" style="background: linear-gradient(135deg, #141e30, #243b55);">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="m-0"><i class="fas fa-chart-pie me-2 text-info"></i>Voice Analysis Results</h2>
                        <p class="text-light mt-2 mb-0">Advanced emotion and voice characteristic detection</p>
                    </div>
                    <div class="bg-dark p-3 rounded-pill d-none d-md-block">
                        <span class="badge bg-secondary p-2 me-1"><i class="fas fa-microphone-alt me-1"></i>Audio</span>
                        <span class="badge bg-info p-2 me-1"><i class="fas fa-brain me-1"></i>AI</span>
                        <span class="badge bg-primary p-2"><i class="fas fa-chart-bar me-1"></i>Analytics</span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="alert alert-success p-4 border-start border-success border-5">
                    <div class="d-flex">
                        <div class="display-1 me-3">
                            <i class="fas fa-check-circle text-success"></i>
                        </div>
                        <div>
                            <h4 class="alert-heading mb-2">Analysis Complete</h4>
                            <p class="mb-0">Our AI has analyzed your audio file and detected the following voice characteristics, emotions, and age estimate:</p>
                        </div>
                    </div>
                </div>
                
                <div class="file-info mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <span class="bg-gradient badge bg-primary text-white p-2 me-2">
                            <i class="fas fa-file-audio"></i>
                        </span>
                        <h5 class="m-0">File Analysis Summary</h5>
                    </div>
                    
                    <div class="row g-3">
                        <!-- File details card -->
                        <div class="col-md-4">
                            <div class="card bg-dark h-100 border-primary">
                                <div class="card-body text-center">
                                    <i class="fas fa-file-audio fa-3x text-primary mb-3"></i>
                                    <h6 class="card-title">Audio File</h6>
                                    <p class="card-text text-truncate">{{ filename }}</p>
                                    <small class="text-muted">Uploaded: {{ upload_date }}</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Age estimate card -->
                        <div class="col-md-4">
                            <div class="card bg-dark h-100 border-info">
                                <div class="card-body text-center">
                                    <i class="fas fa-user-clock fa-3x text-info mb-3"></i>
                                    <h6 class="card-title">Age Estimate</h6>
                                    {% if age_estimate %}
                                        <p class="card-text">{{ age_estimate }}</p>
                                        <div class="progress mt-2">
                                            <div class="progress-bar bg-info" style="width: {{ age_confidence * 100 }}%" role="progressbar" aria-valuenow="{{ age_confidence * 100 }}" aria-valuemin="0" aria-valuemax="100">{{ (age_confidence * 100)|int }}% confidence</div>
                                        </div>
                                    {% else %}
                                        <p class="card-text text-warning">Unknown</p>
                                        <small class="text-muted">Insufficient data for age detection</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Primary emotion card -->
                        <div class="col-md-4">
                            <div class="card bg-dark h-100 
                            {% set primary_emotion = emotions|dictsort(by='value')|reverse|first %}
                            {% if primary_emotion[0] == 'happy' %}border-success
                            {% elif primary_emotion[0] == 'sad' %}border-info
                            {% elif primary_emotion[0] == 'angry' %}border-danger
                            {% elif primary_emotion[0] == 'neutral' %}border-secondary
                            {% elif primary_emotion[0] == 'fearful' %}border-warning
                            {% elif primary_emotion[0] == 'surprised' %}border-primary
                            {% elif primary_emotion[0] == 'disgusted' %}border-purple
                            {% elif primary_emotion[0] == 'calm' %}border-teal
                            {% elif primary_emotion[0] == 'excited' %}border-orange
                            {% else %}border-light{% endif %}">
                                <div class="card-body text-center">
                                    <i class="fas 
                                    {% if primary_emotion[0] == 'happy' %}fa-smile text-success
                                    {% elif primary_emotion[0] == 'sad' %}fa-frown text-info
                                    {% elif primary_emotion[0] == 'angry' %}fa-angry text-danger
                                    {% elif primary_emotion[0] == 'neutral' %}fa-meh text-secondary
                                    {% elif primary_emotion[0] == 'fearful' %}fa-grimace text-warning
                                    {% elif primary_emotion[0] == 'surprised' %}fa-surprise text-primary
                                    {% elif primary_emotion[0] == 'disgusted' %}fa-dizzy text-purple
                                    {% elif primary_emotion[0] == 'calm' %}fa-meditation text-teal
                                    {% elif primary_emotion[0] == 'excited' %}fa-grin-stars text-orange
                                    {% endif %} fa-3x mb-3"></i>
                                    <h6 class="card-title">Primary Emotion</h6>
                                    <p class="card-text">{{ primary_emotion[0]|capitalize }}</p>
                                    <div class="progress mt-2">
                                        <div class="progress-bar 
                                        {% if primary_emotion[0] == 'happy' %}bg-success
                                        {% elif primary_emotion[0] == 'sad' %}bg-info
                                        {% elif primary_emotion[0] == 'angry' %}bg-danger
                                        {% elif primary_emotion[0] == 'neutral' %}bg-secondary
                                        {% elif primary_emotion[0] == 'fearful' %}bg-warning
                                        {% elif primary_emotion[0] == 'surprised' %}bg-primary
                                        {% elif primary_emotion[0] == 'disgusted' %}bg-purple
                                        {% elif primary_emotion[0] == 'calm' %}bg-teal
                                        {% elif primary_emotion[0] == 'excited' %}bg-orange
                                        {% endif %}" style="width: {{ primary_emotion[1] * 100 }}%" role="progressbar" aria-valuenow="{{ primary_emotion[1] * 100 }}" aria-valuemin="0" aria-valuemax="100">{{ (primary_emotion[1] * 100)|int }}%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Voice Characteristics Section -->
                <div class="voice-characteristics mb-4">
                    <h5><i class="fas fa-microphone-alt me-2"></i>Voice Characteristics</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-dark">
                                <tbody>
                                    <tr>
                                        <th scope="row">Pitch (Hz)</th>
                                        <td>
                                            {{ voice_features.pitch }} Hz
                                            <div class="progress mt-1">
                                                <div class="progress-bar bg-info" 
                                                    role="progressbar" 
                                                    style="width: {{ (voice_features.pitch / 400 * 100)|int if voice_features.pitch else 0 }}%" 
                                                    aria-valuenow="{{ voice_features.pitch }}" 
                                                    aria-valuemin="0" 
                                                    aria-valuemax="400">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Speech Rate</th>
                                        <td>
                                            {{ voice_features.speech_rate }} syl/sec
                                            <div class="progress mt-1">
                                                <div class="progress-bar bg-success" 
                                                    role="progressbar" 
                                                    style="width: {{ (voice_features.speech_rate / 10 * 100)|int if voice_features.speech_rate else 0 }}%" 
                                                    aria-valuenow="{{ voice_features.speech_rate }}" 
                                                    aria-valuemin="0" 
                                                    aria-valuemax="10">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Energy</th>
                                        <td>
                                            {{ voice_features.energy }}
                                            <div class="progress mt-1">
                                                <div class="progress-bar bg-danger" 
                                                    role="progressbar" 
                                                    style="width: {{ (voice_features.energy / 0.05 * 100)|int if voice_features.energy else 0 }}%" 
                                                    aria-valuenow="{{ voice_features.energy }}" 
                                                    aria-valuemin="0" 
                                                    aria-valuemax="0.05">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Clarity</th>
                                        <td>
                                            {{ voice_features.clarity }}
                                            <div class="progress mt-1">
                                                <div class="progress-bar bg-warning" 
                                                    role="progressbar" 
                                                    style="width: {{ (voice_features.clarity * 100)|int if voice_features.clarity else 0 }}%" 
                                                    aria-valuenow="{{ voice_features.clarity }}" 
                                                    aria-valuemin="0" 
                                                    aria-valuemax="1">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Tone Variation</th>
                                        <td>
                                            {{ voice_features.tone_variation }}
                                            <div class="progress mt-1">
                                                <div class="progress-bar bg-primary" 
                                                    role="progressbar" 
                                                    style="width: {{ (voice_features.tone_variation * 100)|int if voice_features.tone_variation else 0 }}%" 
                                                    aria-valuenow="{{ voice_features.tone_variation }}" 
                                                    aria-valuemin="0" 
                                                    aria-valuemax="1">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Harmonic Ratio</th>
                                        <td>
                                            {{ voice_features.harmonic_ratio }}
                                            <div class="progress mt-1">
                                                <div class="progress-bar bg-info" 
                                                    role="progressbar" 
                                                    style="width: {{ (voice_features.harmonic_ratio / 3 * 100)|int if voice_features.harmonic_ratio else 0 }}%" 
                                                    aria-valuenow="{{ voice_features.harmonic_ratio }}" 
                                                    aria-valuemin="0" 
                                                    aria-valuemax="3">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6 d-flex align-items-center justify-content-center">
                            <div class="voice-interpretation">
                                <h6 class="text-center mb-3"><i class="fas fa-info-circle me-2"></i>Voice Profile Interpretation</h6>
                                <ul class="list-group">
                                    {% if voice_features.pitch > 200 %}
                                        <li class="list-group-item bg-dark text-light">Higher pitched voice, typically more energetic and expressive</li>
                                    {% else %}
                                        <li class="list-group-item bg-dark text-light">Lower pitched voice, often perceived as calm and authoritative</li>
                                    {% endif %}
                                    
                                    {% if voice_features.speech_rate > 4 %}
                                        <li class="list-group-item bg-dark text-light">Faster speech rate, may indicate excitement or urgency</li>
                                    {% else %}
                                        <li class="list-group-item bg-dark text-light">Moderate to slower speech rate, often associated with thoughtfulness</li>
                                    {% endif %}
                                    
                                    {% if voice_features.energy > 0.01 %}
                                        <li class="list-group-item bg-dark text-light">Higher energy voice, projecting confidence and presence</li>
                                    {% else %}
                                        <li class="list-group-item bg-dark text-light">Lower energy voice, possibly indicating calmness or restraint</li>
                                    {% endif %}
                                    
                                    {% if voice_features.clarity > 0.6 %}
                                        <li class="list-group-item bg-dark text-light">Clear, well-articulated speech with good pronunciation</li>
                                    {% else %}
                                        <li class="list-group-item bg-dark text-light">Speech has some roughness or breathiness qualities</li>
                                    {% endif %}
                                    
                                    {% if voice_features.harmonic_ratio > 1.5 %}
                                        <li class="list-group-item bg-dark text-light">More musical, tonal voice with harmonic qualities</li>
                                    {% else %}
                                        <li class="list-group-item bg-dark text-light">More textured voice with noise/percussive components</li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audio Visualization Section -->
                {% if plots_urls %}
                <div class="audio-visualizations mb-4">
                    <h5><i class="fas fa-wave-square me-2"></i>Audio Visualizations</h5>
                    <ul class="nav nav-tabs" id="audioVisualizationTabs" role="tablist">
                        {% if 'waveform' in plots_urls %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="waveform-tab" data-bs-toggle="tab" data-bs-target="#waveform" type="button" role="tab" aria-controls="waveform" aria-selected="true">Waveform</button>
                        </li>
                        {% endif %}
                        {% if 'spectrogram' in plots_urls %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="spectrogram-tab" data-bs-toggle="tab" data-bs-target="#spectrogram" type="button" role="tab" aria-controls="spectrogram" aria-selected="false">Spectrogram</button>
                        </li>
                        {% endif %}
                        {% if 'mfcc' in plots_urls %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="mfcc-tab" data-bs-toggle="tab" data-bs-target="#mfcc" type="button" role="tab" aria-controls="mfcc" aria-selected="false">MFCC</button>
                        </li>
                        {% endif %}
                    </ul>
                    <div class="tab-content p-3 border border-secondary" id="audioVisualizationTabContent">
                        {% if 'waveform' in plots_urls %}
                        <div class="tab-pane fade show active text-center" id="waveform" role="tabpanel" aria-labelledby="waveform-tab">
                            <img src="{{ plots_urls.waveform }}" alt="Waveform visualization" class="img-fluid">
                            <p class="text-muted mt-2">Waveform: Amplitude vs. Time representation of the audio signal</p>
                        </div>
                        {% endif %}
                        {% if 'spectrogram' in plots_urls %}
                        <div class="tab-pane fade text-center" id="spectrogram" role="tabpanel" aria-labelledby="spectrogram-tab">
                            <img src="{{ plots_urls.spectrogram }}" alt="Spectrogram visualization" class="img-fluid">
                            <p class="text-muted mt-2">Spectrogram: Time-Frequency-Intensity representation of the audio</p>
                        </div>
                        {% endif %}
                        {% if 'mfcc' in plots_urls %}
                        <div class="tab-pane fade text-center" id="mfcc" role="tabpanel" aria-labelledby="mfcc-tab">
                            <img src="{{ plots_urls.mfcc }}" alt="MFCC visualization" class="img-fluid">
                            <p class="text-muted mt-2">MFCC: Mel-Frequency Cepstral Coefficients used for voice characteristic analysis</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Emotion Detection Section -->
                <div class="emotion-detection mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <span class="bg-gradient badge bg-success text-white p-2 me-2">
                            <i class="fas fa-brain"></i>
                        </span>
                        <h5 class="m-0">AI Emotion Analysis</h5>
                    </div>
                    
                    <div class="alert bg-gradient p-4 mb-4" style="background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); border: none;">
                        <div class="d-flex align-items-start">
                            <div class="display-4 me-3 text-white">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="text-white">
                                <h5 class="mb-2">Advanced Emotion Detection</h5>
                                <p class="mb-0">Our machine learning model analyzed <strong>9 distinct emotions</strong> in your voice, revealing patterns in tone, pitch, and speech characteristics that indicate your emotional state.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <!-- Add tabs for different chart types -->
                            <ul class="nav nav-pills mb-3" id="chartTypeTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="pie-tab" data-bs-toggle="pill" data-bs-target="#pie-chart" type="button" role="tab" aria-controls="pie-chart" aria-selected="true">Pie Chart</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="radar-tab" data-bs-toggle="pill" data-bs-target="#radar-chart" type="button" role="tab" aria-controls="radar-chart" aria-selected="false">Radar Chart</button>
                                </li>
                            </ul>
                            
                            <!-- Tab content -->
                            <div class="tab-content" id="chartTypeTabsContent">
                                <div class="tab-pane fade show active" id="pie-chart" role="tabpanel" aria-labelledby="pie-tab">
                                    <div class="chart-container" style="position: relative; height: 300px;">
                                        <canvas id="emotionPieChart"></canvas>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="radar-chart" role="tabpanel" aria-labelledby="radar-tab">
                                    <div class="chart-container" style="position: relative; height: 300px;">
                                        <canvas id="emotionRadarChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="border-bottom pb-2">Emotion Breakdown</h6>
                            <ul class="list-group">
                                {% for emotion, score in emotions|dictsort(by='value')|reverse %}
                                <li class="list-group-item bg-dark text-light d-flex justify-content-between align-items-center">
                                    <span>
                                        <i class="fas 
                                        {% if emotion == 'happy' %}fa-smile text-success
                                        {% elif emotion == 'sad' %}fa-frown text-info
                                        {% elif emotion == 'angry' %}fa-angry text-danger
                                        {% elif emotion == 'neutral' %}fa-meh text-secondary
                                        {% elif emotion == 'fearful' %}fa-grimace text-warning
                                        {% elif emotion == 'surprised' %}fa-surprise text-primary
                                        {% elif emotion == 'disgusted' %}fa-dizzy text-purple
                                        {% elif emotion == 'calm' %}fa-meditation text-teal
                                        {% elif emotion == 'excited' %}fa-grin-stars text-orange
                                        {% endif %} me-2"></i>
                                        {{ emotion|capitalize }}
                                    </span>
                                    <div class="d-flex align-items-center" style="width: 60%;">
                                        <div class="progress flex-grow-1">
                                            <div class="progress-bar 
                                            {% if emotion == 'happy' %}bg-success
                                            {% elif emotion == 'sad' %}bg-info
                                            {% elif emotion == 'angry' %}bg-danger
                                            {% elif emotion == 'neutral' %}bg-secondary
                                            {% elif emotion == 'fearful' %}bg-warning
                                            {% elif emotion == 'surprised' %}bg-primary
                                            {% elif emotion == 'disgusted' %}bg-purple
                                            {% elif emotion == 'calm' %}bg-teal
                                            {% elif emotion == 'excited' %}bg-orange
                                            {% endif %}" 
                                            role="progressbar" 
                                            style="width: {{ (score * 100)|int }}%" 
                                            aria-valuenow="{{ (score * 100)|int }}" 
                                            aria-valuemin="0" 
                                            aria-valuemax="100">
                                            </div>
                                        </div>
                                        <span class="ms-2 text-muted">{{ (score * 100)|round(1) }}%</span>
                                    </div>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Recommendations Section -->
                <div class="activity-recommendations mb-4">
                    <h5 class="d-flex align-items-center mb-3">
                        <span class="bg-gradient badge bg-info text-white p-2 me-2">
                            <i class="fas fa-lightbulb"></i>
                        </span>
                        <span>Personalized Activity Recommendations</span>
                    </h5>
                    
                    <div class="alert alert-info p-3 border-start border-info border-5">
                        <div class="d-flex align-items-start">
                            <div class="display-4 me-3">
                                <i class="fas fa-brain text-primary"></i>
                            </div>
                            <div>
                                <h5 class="mb-2">Mood-Based Recommendations</h5>
                                <p class="mb-0">Based on your detected emotional profile, our AI has generated personalized activities to enhance your current state:</p>
                            </div>
                        </div>
                    </div>
                    
                    {% if recommendations %}
                    <div class="row row-cols-1 row-cols-md-3 g-4">
                        {% for recommendation in recommendations %}
                        {% set icon_class = 'fa-star' %}
                        {% set card_color = 'bg-dark' %}
                        {% set text_color = '' %}
                        {% set gradient = '' %}
                        
                        {% if 'meditate' in recommendation|lower or 'breathing' in recommendation|lower %}
                            {% set icon_class = 'fa-om' %}
                            {% set card_color = 'bg-gradient' %}
                            {% set gradient = 'background: linear-gradient(135deg, #20234f, #444b8a);' %}
                        {% elif 'listen' in recommendation|lower or 'music' in recommendation|lower %}
                            {% set icon_class = 'fa-music' %}
                            {% set card_color = 'bg-gradient' %}
                            {% set gradient = 'background: linear-gradient(135deg, #5f2c82, #49a09d);' %}
                        {% elif 'exercise' in recommendation|lower or 'walk' in recommendation|lower %}
                            {% set icon_class = 'fa-running' %}
                            {% set card_color = 'bg-gradient' %}
                            {% set gradient = 'background: linear-gradient(135deg, #11998e, #38ef7d);' %}
                            {% set text_color = 'text-dark' %}
                        {% elif 'journal' in recommendation|lower or 'write' in recommendation|lower %}
                            {% set icon_class = 'fa-pen-fancy' %}
                            {% set card_color = 'bg-gradient' %}
                            {% set gradient = 'background: linear-gradient(135deg, #2980b9, #2c3e50);' %}
                        {% elif 'socialize' in recommendation|lower or 'friend' in recommendation|lower %}
                            {% set icon_class = 'fa-users' %}
                            {% set card_color = 'bg-gradient' %}
                            {% set gradient = 'background: linear-gradient(135deg, #ff416c, #ff4b2b);' %}
                        {% elif 'hobby' in recommendation|lower or 'creative' in recommendation|lower %}
                            {% set icon_class = 'fa-palette' %}
                            {% set card_color = 'bg-gradient' %}
                            {% set gradient = 'background: linear-gradient(135deg, #654ea3, #eaafc8);' %}
                        {% elif 'nature' in recommendation|lower or 'outside' in recommendation|lower %}
                            {% set icon_class = 'fa-tree' %}
                            {% set card_color = 'bg-gradient' %}
                            {% set gradient = 'background: linear-gradient(135deg, #076585, #0c9);' %}
                        {% elif 'sleep' in recommendation|lower or 'rest' in recommendation|lower %}
                            {% set icon_class = 'fa-bed' %}
                            {% set card_color = 'bg-gradient' %}
                            {% set gradient = 'background: linear-gradient(135deg, #141e30, #243b55);' %}
                        {% endif %}
                        
                        <div class="col">
                            <div class="card h-100 {{ card_color }} shadow" {% if gradient %}style="{{ gradient }}"{% endif %}>
                                <div class="card-body {{ text_color }}">
                                    <div class="mb-3">
                                        <span class="rounded-circle d-inline-flex justify-content-center align-items-center p-3" style="width: 50px; height: 50px; background-color: rgba(255,255,255,0.2);">
                                            <i class="fas {{ icon_class }} fa-lg"></i>
                                        </span>
                                    </div>
                                    <h5 class="card-title">
                                        {{ recommendation.split(':')[0] if ':' in recommendation else recommendation }}
                                    </h5>
                                    <p class="card-text mt-3 opacity-90">
                                        {% if ':' in recommendation %}
                                            {{ recommendation.split(':', 1)[1] }}
                                        {% else %}
                                            A recommended activity based on your emotional profile.
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>No specific recommendations available for your emotional profile.
                    </div>
                    {% endif %}
                </div>
                
                <!-- Disclaimer -->
                <div class="disclaimer text-center mt-5">
                    <div class="card bg-dark border-0 shadow-lg" style="background: linear-gradient(135deg, #141e30, #243b55);">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-center mb-3">
                                <div class="rounded-circle bg-light p-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                    <i class="fas fa-info text-primary fa-2x"></i>
                                </div>
                            </div>
                            <h5 class="card-title">About This Analysis</h5>
                            <p class="card-text mb-0">This analysis uses machine learning to estimate emotions from voice patterns. While not clinically validated, our models provide useful insights into vocal characteristics and emotional tones. The recommendations are provided as general suggestions based on detected emotional patterns.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Prepare data for the charts
        const emotions = {{ emotions|tojson }};
        const labels = Object.keys(emotions).map(emotion => emotion.charAt(0).toUpperCase() + emotion.slice(1));
        const scores = Object.values(emotions);
        
        // Define colors for each emotion
        const backgroundColors = {
            'Happy': 'rgba(40, 167, 69, 0.7)',       // Green
            'Sad': 'rgba(23, 162, 184, 0.7)',        // Cyan
            'Angry': 'rgba(220, 53, 69, 0.7)',       // Red
            'Neutral': 'rgba(108, 117, 125, 0.7)',   // Gray
            'Fearful': 'rgba(255, 193, 7, 0.7)',     // Yellow
            'Surprised': 'rgba(111, 66, 193, 0.7)',  // Purple
            'Disgusted': 'rgba(102, 16, 242, 0.7)',  // Indigo
            'Calm': 'rgba(32, 201, 151, 0.7)',       // Teal
            'Excited': 'rgba(253, 126, 20, 0.7)'     // Orange
        };
        
        // Create the colors array in the same order as labels
        const colors = labels.map(label => backgroundColors[label] || 'rgba(108, 117, 125, 0.7)');
        const borderColors = labels.map(label => backgroundColors[label]?.replace('0.7', '1') || 'rgba(108, 117, 125, 1)');
        
        // Create the pie chart
        const pieCtx = document.getElementById('emotionPieChart').getContext('2d');
        const emotionPieChart = new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: scores,
                    backgroundColor: colors,
                    borderColor: 'rgba(255, 255, 255, 0.2)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: 'white',
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.formattedValue;
                                return `${label}: ${value}`;
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: 'Emotion Distribution',
                        color: 'white',
                        font: {
                            size: 16
                        }
                    }
                }
            }
        });
        
        // Create the radar chart
        const radarCtx = document.getElementById('emotionRadarChart').getContext('2d');
        const emotionRadarChart = new Chart(radarCtx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Emotion Intensity',
                    data: scores,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: colors,
                    pointBorderColor: borderColors,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: borderColors,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: {
                            color: 'rgba(255, 255, 255, 0.2)'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.2)'
                        },
                        pointLabels: {
                            color: 'white',
                            font: {
                                size: 12
                            }
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)',
                            backdropColor: 'transparent',
                            showLabelBackdrop: false
                        },
                        suggestedMin: 0,
                        suggestedMax: 1
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.formattedValue;
                                return `${label}: ${value}`;
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: 'Emotion Intensity Profile',
                        color: 'white',
                        font: {
                            size: 16
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}
